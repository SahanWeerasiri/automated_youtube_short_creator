import 'package:flame/components.dart';
import 'package:temple_run_2d/game/components/player_component.dart';

class Obstacle extends SpriteComponent {
  final int type; // 0: rock, 1: log, 2: pit
  final double speed;
  
  Obstacle({
    required this.type,
    required Vector2 position,
    required Vector2 size,
    required this.speed,
  }) : super(position: position, size: size);
  
  @override
  Future<void> onLoad() async {
    // Load different sprites based on obstacle type
    switch (type) {
      case 0:
        sprite = await Sprite.load('obstacles/rock.png');
        break;
      case 1:
        sprite = await Sprite.load('obstacles/log.png');
        break;
      case 2:
        sprite = await Sprite.load('obstacles/pit.png');
        break;
    }
    
    return super.onLoad();
  }
  
  @override
  void update(double dt) {
    position.y += speed * dt;
    super.update(dt);
  }
  
  bool collidesWithPlayer(PlayerComponent player) {
    if (player.isJumping && type != 2) {
      // Player can jump over rocks and logs
      return false;
    }
    
    // Simple collision detection
    final playerRect = player.toRect();
    final obstacleRect = toRect();
    
    // Reduce collision size for better gameplay feel
    final collisionRect = obstacleRect.deflate(size.x * 0.2);
    
    return playerRect.overlaps(collisionRect);
  }
}
